{% extends 'base.html' %}
{% load static %}

{% block content %}
<main class="container py-5">
    <section class="card card-body shadow-sm p-4">
        <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center pb-4">
                <h1 class="display-5">Creación de fichas</h1>
                <div>
                <button type="button" class="btn btn-warning" data-bs-toggle="modal" data-bs-target="#instruccionesModal">
                    Ver Instrucciones CSV
                </button>
                </div>
                <div>
                <a href="/media/formatos/formato_carga_masiva_fichas.csv" class="btn btn-success" download>
                    Descargar Formato Oficial
                </a>
                </div>
            </div>

            <form id="form-cargar-ficha" autocomplete="off" enctype="multipart/form-data" method="POST" class="mt-4">
            {% csrf_token %}


            <div class="row">
                <!-- Número de ficha -->
                <div class="col-md-6 mb-3">
                <label for="num_ficha" class="form-label">Número de ficha</label>
                <input type="text" class="form-control" name="num_ficha" id="num_ficha">
                </div>

                <!-- Fase actual -->
                <div class="col-md-6 mb-3">
                <label for="fase_actual" class="form-label">Fase actual</label>
                <select name="fase_actual" id="fase_actual" class="form-select" required>
                    <option value="1">Análisis</option>
                    <option value="2">Planeación</option>
                    <option value="3">Ejecución</option>
                    <option value="4">Evaluación</option>
                </select>
                </div>

                <!-- Departamento -->
                <div class="col-md-6 mb-3">
                <label for="departamento" class="form-label">Departamento</label>
                <div id="contenedor-departamento">
                    <div class="placeholder-glow">
                        <span class="placeholder col-12 rounded"></span>
                    </div>
                </div>
                </div>

                <!-- Municipio -->
                <div class="col-md-6 mb-3">
                <label for="municipio" class="form-label">Municipio</label>
                <div id="contenedor-municipio">
                    <div class="placeholder-glow">
                        <span class="placeholder col-12 rounded"></span>
                    </div>
                </div>
                </div>

                <!-- Colegio -->
                <div class="col-md-6 mb-3">
                <label for="colegio" class="form-label">Colegio</label>
                <div id="contenedor-colegio">
                    <div class="placeholder-glow">
                        <span class="placeholder col-12 rounded"></span>
                    </div>
                </div>
                </div>

                <!-- Centro de formación -->
                <div class="col-md-6 mb-3">
                <label for="centro_forma" class="form-label">Centro de formación</label>
                <div id="contenedor-centro-forma">
                    <div class="placeholder-glow">
                        <span class="placeholder col-12 rounded"></span>
                    </div>
                </div>
                </div>

                <!-- Programa de formación -->
                <div class="col-md-6 mb-3">
                <label for="programa" class="form-label">Programa de formación</label>
                <div id="contenedor-programa">
                    <div class="placeholder-glow">
                        <span class="placeholder col-12 rounded"></span>
                    </div>
                </div>
                </div>


                <div class="col-md-6 mb-3">
                    <label for="archivo" class="form-label">Seleccione un archivo CSV</label>
                    <input type="file" class="form-control" name="archivo" id="archivo" required>
                </div>

            </div>

            <!-- Botón de envío (una sola columna) -->
            <div class="mt-3">
                <button type="submit" id="submitBtn" class="btn btn-primary">Cargar ficha</button>
            </div>
            </form>



            <!-- Alerta de error -->
            <div id="alert-error" class="alert alert-danger d-none mt-3" style="white-space: pre-wrap; font-family: monospace;"></div>

            <!-- Alerta de éxito -->
            <div id="alert-success" class="alert alert-success mt-3 d-none">
                <ul id="alert-success-content">
                </ul>
            </div>

                <div id="alert-message" class="alert alert-success mt-3 d-none" style="white-space: pre-line;"></div>
            </div>
        </div>
        </div>
    </section> 
</main>


<!-- Modal de Instrucciones -->
<div class="modal fade" id="instruccionesModal" tabindex="-1" aria-labelledby="instruccionesModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
        <div class="modal-header">
            <h5 class="modal-title" id="instruccionesModalLabel">Instrucciones para el formato CSV - Instructores</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
            <h5>Requisitos del archivo CSV:</h5>
            <ul class="list-group list-group-flush mb-4">
            <li class="list-group-item">✅ El archivo debe estar en formato <strong>CSV</strong></li>
            <li class="list-group-item">✅ Mantener los nombres de las columnas tal como se indican</li>
            <li class="list-group-item">✅ Codificación UTF-8</li>
            <li class="list-group-item">✅ Delimitador: coma (,)</li>
            </ul>

            <h5>Instrucciones de llenado:</h5>
            <div class="alert alert-warning">
            <strong>Campos obligatorios:</strong> Todos excepto <code>contra</code>, <code>fecha_ini</code> y <code>fecha_fin</code> deben estar completos.
            </div>

            <table class="table table-striped">
            <thead>
                <tr>
                <th>Campo</th>
                <th>Descripción / Requisitos</th>
                </tr>
            </thead>
            <tbody>
                <tr><td>email</td><td>Correo electrónico válido</td></tr>
                <tr><td>nom</td><td>Nombres del instructor</td></tr>
                <tr><td>apelli</td><td>Apellidos del instructor</td></tr>
                <tr>
                <td>tipo_dni</td>
                <td>Tipo de documento: <code>ti</code>, <code>cc</code>, <code>pp</code>, <code>ce</code></td>
                </tr>
                <tr><td>dni</td><td>Número de documento, sin puntos ni espacios</td></tr>
                <tr><td>tele</td><td>Teléfono sin caracteres especiales</td></tr>
                <tr><td>dire</td><td>Dirección de residencia</td></tr>
                <tr>
                <td>gene</td>
                <td>Género: <code>H</code> (Masculino), <code>M</code> (Femenino)</td>
                </tr>
                <tr><td>fecha_naci</td><td>Fecha de nacimiento en formato <code>DD/MM/AAAA</code></td></tr>
                <tr><td>contra</td><td>(Opcional) Número de contrato</td></tr>
                <tr><td>fecha_ini</td><td>(Opcional) Fecha inicio del contrato <code>DD/MM/AAAA</code></td></tr>
                <tr><td>fecha_fin</td><td>(Opcional) Fecha fin del contrato <code>DD/MM/AAAA</code></td></tr>
                <tr>
                <td>profe</td>
                <td>
                    Profesión del instructor. En negrilla las opciones válidas (en minúsculas y sin tildes): 
                    <ul>
                        <li><strong>ingenieros</strong>: Ingeniero de sistemas </li>
                        <li><strong>ingenieroe</strong>: Ingeniero electrónico</li>
                        <li><strong>tecnologodf</strong>: Tecnólogo en desarrollo de software</li>
                        <li><strong>ingenierosof</strong>: Ingeniero de software</li>
                    </ul>
                </td>
                </tr>
                <tr>
                <td>tipo_vincu</td>
                <td>Tipo de vinculación. En negrilla las opciones válidas (en minúsculas y sin tildes): 
                    <ul>
                    <li><strong>termino indefinido</strong>: Termino indefinido</li>
                    <li><strong>colaborador externo</strong>: Colaborador externo</li>
                    <li><strong>obra</strong>: Obra labor</li>
                    <li><strong>presta</strong>: Prestación de Servicios</li>
                    <li><strong>sindefinir</strong>: Sin definir</li>
                    </ul>
                </td>
                </tr>
            </tbody>
            </table>

            <div class="alert alert-danger mt-3">
            <strong>⚠️ Importante:</strong>
            <ul>
                <li>No modificar el orden de las columnas</li>
                <li>No usar tildes ni la letra ñ</li>
                <li>Verifica que los DNI no estén duplicados</li>
            </ul>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
        </div>
        </div>
    </div>
</div>


{% endblock %}

{% block scripts %}
<script type ="module" src="{% static 'js/formacion/masivo_fichas.js' %}"></script>
{% endblock %}